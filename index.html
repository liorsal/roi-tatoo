<!-- ===== BOOTSTRAP לנגישות: יוצר שלד, קונפיג, ואז טוען את הווידג'ט ===== -->
<script>
(function () {
  // 1) labels ברירת מחדל (לא "var"/"const" כדי לא להתנגש)
  window.labels = window.labels || {
    incText:"הגדלת טקסט", spacing:"ריווח טקסט",
    highContrast:"ניגודיות גבוהה", darkContrast:"ניגודיות כהה",
    grayscale:"גווני אפור", invert:"היפוך צבעים",
    underlineLinks:"קו תחתון לקישורים", highlightLinks:"הדגשת קישורים",
    dyslexia:"גופן נגיש (דיסלקסיה)", bigCursor:"סמן עכבר גדול",
    noAnim:"ביטול אנימציות", focusMode:"פוקוס קריאה",
    readAloud:"קריאה בקול", visionProfile:"פרופיל כבדי ראייה",
    dyslexiaProfile:"פרופיל דיסלקציה", cognitiveProfile:"פרופיל קוגניטיבי",
    reset:"איפוס הגדרות"
  };

  // 2) הגדרות ברירת מחדל + shim ל-liorAcc (יש קוד שפונה בלי window.)
  window.liorAcc = window.liorAcc || {};
  window.liorAcc.settings = Object.assign({
    position: 'right',
    declaration: '/accessibility',
    lang: (document.documentElement && document.documentElement.lang) || 'he',
    fontUrl: ''
  }, window.liorAcc.settings || {});
  if (typeof liorAcc === 'undefined') { var liorAcc = window.liorAcc; }

  // 3) יצירת כל האלמנטים שהווידג'ט מצפה להם
  var d = document;
  var root = d.getElementById('lior-acc-root');
  if (!root) {
    root = d.createElement('div');
    root.id = 'lior-acc-root';
    root.className = 'lior-acc-root lior-acc-pos-right';
    root.setAttribute('aria-live','polite');
    d.body.appendChild(root);
  }

  if (!d.getElementById('lior-acc-live-region')) {
    var live = d.createElement('div');
    live.id = 'lior-acc-live-region';
    live.className = 'lior-acc-sr-only';
    live.setAttribute('aria-live','polite');
    live.setAttribute('aria-atomic','true');
    root.appendChild(live);
  }

  if (!d.getElementById('lior-acc-button')) {
    var btn = d.createElement('button');
    btn.id = 'lior-acc-button';
    btn.className = 'lior-acc-button';
    btn.type = 'button';
    btn.setAttribute('aria-haspopup','dialog');
    btn.setAttribute('aria-controls','lior-acc-panel');
    btn.setAttribute('aria-expanded','false');
    btn.setAttribute('aria-label','פתח תפריט נגישות');
    btn.innerHTML = '<span aria-hidden="true">♿</span>';
    root.appendChild(btn);
  }

  if (!d.getElementById('lior-acc-overlay')) {
    var overlay = d.createElement('div');
    overlay.id = 'lior-acc-overlay';
    overlay.className = 'lior-acc-overlay';
    overlay.hidden = true;
    root.appendChild(overlay);
  }

  if (!d.getElementById('lior-acc-panel')) {
    var panel = d.createElement('div');
    panel.id = 'lior-acc-panel';
    panel.className = 'lior-acc-panel';
    panel.setAttribute('role','dialog');
    panel.setAttribute('aria-modal','true');
    panel.setAttribute('aria-labelledby','lior-acc-title');
    panel.hidden = true;

    panel.innerHTML =
      '<div class="lior-acc-panel-header">' +
        '<h2 id="lior-acc-title">תפריט נגישות</h2>' +
        '<button id="lior-acc-close" class="lior-acc-close" type="button" aria-label="סגור">×</button>' +
      '</div>' +
      '<div class="lior-acc-panel-body">' +
        '<ul class="lior-acc-list" role="list"></ul>' +
        '<button id="lior-acc-reset" class="lior-acc-reset" type="button">איפוס הגדרות</button>' +
      '</div>';

    root.appendChild(panel);
  }

  // 4) טען את הסקריפט: GitHub Pages → jsDelivr → GitHack (עם שבירת קאש)
  function load(src, fallback) {
    var s = d.createElement('script');
    s.defer = true;
    s.src = src;
    if (fallback) {
      s.onerror = function(){ this.onerror=null; this.remove(); load(fallback); };
    }
    d.body.appendChild(s);
  }
  var ts = Date.now();
  load(
    'https://liorsal.github.io/negi-vs/widget-v2.js?ts=' + ts,
    'https://cdn.jsdelivr.net/gh/liorsal/negi-vs@main/widget-v2.js?v=' + ts
  );
})();
</script>
<!-- ===== סוף BOOTSTRAP ===== -->
